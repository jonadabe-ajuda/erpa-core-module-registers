package br.com.erpa.infra;

import java.util.ArrayList;
import java.util.List;

import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;
import javax.persistence.Persistence;
import javax.persistence.Query;

import br.com.erpa.application.BuilderProducts;
import br.com.erpa.domain.entity.ProductsEntity;
import br.com.erpa.domain.model.Produtcts;
import br.com.erpa.domain.repository.RepositoryProducts;

/**
 * Repository products with jpa used in mysql
 *  
 * @author jonadabe
 * @param  methods Constructor RepositoryProducts
 * @param  methods insertProducts ProductsEntity
 * @param  methods updateProducts ProductsEntity
 * @param  methods deleteProducts ProductsEntity
 * @param  methods findByProducts Strng codigo
 * @param  methods convertToCustomerEntity Customers
 * @param  methods convertToCustomer CustomersEntity
 * @return findByCustomer CustomerEntity
 * @return listaAllCustomers List<CustomersEntity>
 */
public class RepositoryProductsMysql implements RepositoryProducts {

	private final String unitPersistence;
	
	public RepositoryProductsMysql(String unitPersistence) {
		this.unitPersistence = unitPersistence;
	}	


	private EntityManagerFactory entityManagerFactory() {
		EntityManagerFactory emf = Persistence.createEntityManagerFactory(unitPersistence);
		return emf; 
	}



	@Override
	public void insertProducts(ProductsEntity productsEntity) {
		EntityManager em = entityManagerFactory().createEntityManager();
		em.getTransaction().begin();
		em.persist(convertToCustomer(customersEntity));
		em.getTransaction().commit();
		
	}



	@Override
	public void updateProducts(ProductsEntity productsEntity) {
		// TODO Auto-generated method stub
		
	}



	@Override
	public void deleteProducts(ProductsEntity productsEntity) {
		// TODO Auto-generated method stub
		
	}



	@Override
	public ProductsEntity findByCodigo(String codigo) {
		// TODO Auto-generated method stub
		return null;
	}



	@Override
	public List<ProductsEntity> listaAllProducts() {
		// TODO Auto-generated method stub
		return null;
	}	
	
	
	
	private Produtcts bankFindByCustomer(EntityManager em, String cpf) {
		String sql = "SELECT customers FROM Customers customers where customers.cpf = :cpf ";
		Query query = em.createQuery(sql);
		query.setParameter("cpf",cpf);
		query.setMaxResults(1);
		return (Produtcts) query.getSingleResult();		
	}
	
	private ProductsEntity convertToCustomerEntity( Produtcts customer ) {
		ProductsEntity customersEntity = new BuilderProducts()
		   .withCPFName(customer.getCpf(), customer.getName())
		   .addressComplete(customer.getStreet(), 
							customer.getNumber(), 
							customer.getDistrict(),
							customer.getCity(),
				   			customer.getState(),
				   			customer.getZipCode())
		   .create();		
		return customersEntity;
	}
	
	private Produtcts convertToProduct( ProductsEntity productsEntity ) {
		Produtcts products = new Produtcts();
		products.setCodigo(productsEntity.getCodigo());
		products.setName(productsEntity.getName());
		products.setIsActive(productsEntity.getIsActive());
		products.setValueSale(productsEntity.getValueSale());
		return products;
	}
		
	
	

}
